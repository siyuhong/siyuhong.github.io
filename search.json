[{"title":"CMake 入门教程","url":"/2025/12/14/cmake-tutorial01/","content":"CMake 简介什么是 CMakeCMake（Cross-platform Make）是一个开源的跨平台构建系统生成器。它使用简单的配置文件（CMakeLists.txt）来控制软件编译过程，并生成适用于不同平台的原生构建文件（如 Unix Makefile、Visual Studio 项目文件等）。\n\n为什么使用 CMake\n跨平台支持：一套配置文件可在 Windows、Linux、macOS 等平台使用\nIDE 集成：支持生成多种 IDE 项目文件\n现代化设计：支持目标为中心的构建系统\n强大的依赖管理：内置包查找和依赖管理功能\n广泛采用：大量开源项目使用 CMake，已经成为 C++ 项目构建的事实标准\n\n安装 CMakeWindows:CMake官网下载安装包\nLinux (Ubuntu&#x2F;Debian):\nsudo apt updatesudo apt install cmake\n安装完成后，可通过以下命令验证\ncmake --version\n\n快速开始第一个 CMake 项目创建项目结构：\nmy_project/├── CMakeLists.txt└── main.cpp\n\nmain.cpp:\n#include &lt;iostream&gt;int main() &#123;    std::cout &lt;&lt; &quot;Hello, CMake!&quot; &lt;&lt; std::endl;    return 0;&#125;\n\nCMakeLists.txt:\ncmake_minimum_required(VERSION 3.15)project(MyProject VERSION 1.0.0 LANGUAGES CXX)add_executable(my_app main.cpp)\n\n构建流程以Ubuntu 为例\n# 创建构建目录mkdir buildcd build# 配置项目cmake ..# 编译make# 在构建目录执行./my_app# 输出&gt; Hello, CMake!\n\n\n基础概念CMakeLists.txt 基本结构# 1. 指定最低 CMake 版本cmake_minimum_required(VERSION 3.15)# 2. 定义项目project(ProjectName    VERSION 1.0.0    DESCRIPTION &quot;Project description&quot;    LANGUAGES CXX)# 3. 设置 C++ 标准set(CMAKE_CXX_STANDARD 17)set(CMAKE_CXX_STANDARD_REQUIRED ON)# 4. 添加可执行文件或库add_executable(target_name source1.cpp source2.cpp)# 5. 链接库（如果需要）target_link_libraries(target_name PRIVATE some_library)\n\n项目（Project）Project 是 CMake 构建系统的顶层容器，使用 project() 命令定义：Project 完整语法如下：\nproject(&lt;PROJECT-NAME&gt; [&lt;language-name&gt;...])project(&lt;PROJECT-NAME&gt;    [VERSION &lt;major&gt;[.&lt;minor&gt;[.&lt;patch&gt;[.&lt;tweak&gt;]]]]    [DESCRIPTION &lt;project-description-string&gt;]    [HOMEPAGE_URL &lt;url-string&gt;]    [LANGUAGES &lt;language-name&gt;...])```  - `&lt;PROJECT-NAME&gt;` 项目的名称，必须唯一- `[VERSION &lt;major&gt;[.&lt;minor&gt;[.&lt;patch&gt;[.&lt;tweak&gt;]]]]` 项目的版本号，最多包含四个部分- `[DESCRIPTION &lt;project-description-string&gt;]` 项目的简要描述信息- `[HOMEPAGE_URL &lt;url-string&gt;]` 项目主页链接地址- `[LANGUAGES &lt;language-name&gt;...]` 显式声明项目所用的编程语言列表，如 C, CXX示例：```cmakeproject(MyProject    VERSION 1.2.3.4    DESCRIPTION &quot;My awesome project&quot;    HOMEPAGE_URL &quot;https://example.com&quot;    LANGUAGES CXX)\n\n项目定义后，CMake 会自动设置以下变量：\n\nPROJECT_NAME: 项目名称\nPROJECT_VERSION: 项目版本\nPROJECT_SOURCE_DIR: 项目源码根目录，包含顶级 CMakeLists.txt 文件的目录\nPROJECT_BINARY_DIR: 项目构建根目录，运行 cmake 命令时所在的目录\n\n目标（Target）目标是 CMake 的核心概念，代表构建系统的输出产物：\n\n可执行文件目标: add_executable()\n库目标: add_library()\n自定义目标: add_custom_target()\n\n现代 CMake 推荐以目标为中心进行配置。\nadd_executable 完整语法如下：\nadd_executable(&lt;name&gt; [WIN32] [MACOSX_BUNDLE] [EXCLUDE_FROM_ALL]               [source1] [source2 ...])\n\n&lt;name&gt; 目标的名称，必须唯一\n[WIN32] （可选）在 Windows 上创建 Win32 GUI 应用程序\n[MACOSX_BUNDLE]（可选）在 macOS 上创建应用程序 bundle\n[EXCLUDE_FROM_ALL]（可选）目标不会被默认构建，需要显式指定才会构建\n[source1] [source2 ...]（可选）源文件列表，如果不带源文件列表，需要后续使用target_sources添加源文件\n\n在  第一个CMake项目 中，我们创建了一个简单的可执行文件 my_app。\nadd_executable(my_app main.cpp)\n\n生成器（Generator）生成器决定 CMake 生成何种构建文件：\n# 查看可用生成器cmake --help&gt; GeneratorsThe following generators are available on this platform (* marks default):  Green Hills MULTI            = Generates Green Hills MULTI files                                 (experimental, work-in-progress).* Unix Makefiles               = Generates standard UNIX makefiles.  Ninja                        = Generates build.ninja files.  Ninja Multi-Config           = Generates build-&lt;Config&gt;.ninja files.  Watcom WMake                 = Generates Watcom WMake makefiles.  CodeBlocks - Ninja           = Generates CodeBlocks project files.  CodeBlocks - Unix Makefiles  = Generates CodeBlocks project files.  CodeLite - Ninja             = Generates CodeLite project files.  CodeLite - Unix Makefiles    = Generates CodeLite project files.  Eclipse CDT4 - Ninja         = Generates Eclipse CDT 4.0 project files.  Eclipse CDT4 - Unix Makefiles= Generates Eclipse CDT 4.0 project files.  Kate - Ninja                 = Generates Kate project files.  Kate - Unix Makefiles        = Generates Kate project files.  Sublime Text 2 - Ninja       = Generates Sublime Text 2 project files.  Sublime Text 2 - Unix Makefiles                               = Generates Sublime Text 2 project files.\n\n构建类型（Build Type）CMake 支持多种构建类型：\n\nDebug: 包含调试信息，无优化\nRelease: 优化，无调试信息\nRelWithDebInfo: 优化 + 调试信息\nMinSizeRel: 最小化大小优化\n\n# 设置默认构建类型if(NOT CMAKE_BUILD_TYPE)    set(CMAKE_BUILD_TYPE Release)endif()\n\n注意： 通常不需要在CMake中设置，而是在IDE中配置\n\nCMake 语法基础命令语法CMake 命令不区分大小写，但推荐使用小写：\n# 基本语法command(argument1 argument2 ...)# 带关键字参数command(TARGET target_name    PROPERTY value    OPTIONS opt1 opt2)# 注释# 这是单行注释#[[这是多行注释可以跨越多行]]\n\n变量普通变量# 设置变量set(MY_VAR &quot;value&quot;)set(MY_LIST &quot;item1&quot; &quot;item2&quot; &quot;item3&quot;)# 使用变量message(&quot;Value: $&#123;MY_VAR&#125;&quot;)# 取消设置unset(MY_VAR)# 变量作用域function(my_function)    set(LOCAL_VAR &quot;local&quot;)  # 函数内局部变量    set(PARENT_VAR &quot;parent&quot; PARENT_SCOPE)  # 设置父作用域变量endfunction()\n\n缓存变量# 缓存变量（保存在 CMakeCache.txt）set(MY_CACHE_VAR &quot;value&quot; CACHE STRING &quot;Description&quot;)# 类型：BOOL, FILEPATH, PATH, STRING, INTERNALset(ENABLE_FEATURE ON CACHE BOOL &quot;Enable feature&quot;)# 强制设置缓存变量set(MY_VAR &quot;value&quot; CACHE STRING &quot;Description&quot; FORCE)\n\n环境变量# 读取环境变量message(&quot;PATH: $ENV&#123;PATH&#125;&quot;)# 设置环境变量（仅在 CMake 进程中）set(ENV&#123;MY_VAR&#125; &quot;value&quot;)\n\n列表（Lists）# 创建列表set(MY_LIST &quot;a&quot; &quot;b&quot; &quot;c&quot;)set(MY_LIST &quot;a;b;c&quot;)  # 等价写法# 追加元素list(APPEND MY_LIST &quot;d&quot; &quot;e&quot;)# 插入元素list(INSERT MY_LIST 0 &quot;first&quot;)# 移除元素list(REMOVE_ITEM MY_LIST &quot;b&quot;)# 获取长度list(LENGTH MY_LIST list_length)# 获取元素list(GET MY_LIST 0 first_item)# 查找元素list(FIND MY_LIST &quot;c&quot; index)# 排序list(SORT MY_LIST)# 反转list(REVERSE MY_LIST)\n\n字符串操作# 字符串拼接set(STR1 &quot;Hello&quot;)set(STR2 &quot;World&quot;)set(RESULT &quot;$&#123;STR1&#125; $&#123;STR2&#125;&quot;)# 字符串替换string(REPLACE &quot;old&quot; &quot;new&quot; output_var &quot;$&#123;input_string&#125;&quot;)# 正则表达式匹配string(REGEX MATCH &quot;pattern&quot; output_var &quot;$&#123;input_string&#125;&quot;)# 大小写转换string(TOUPPER &quot;$&#123;input&#125;&quot; output)string(TOLOWER &quot;$&#123;input&#125;&quot; output)# 字符串长度string(LENGTH &quot;$&#123;input&#125;&quot; length)# 子字符串string(SUBSTRING &quot;$&#123;input&#125;&quot; 0 5 output)\n\n条件语句# if-elseif(condition)    # ...elseif(other_condition)    # ...else()    # ...endif()# 常用条件if(DEFINED MY_VAR)          # 变量已定义if(EXISTS &quot;$&#123;file_path&#125;&quot;)   # 文件存在if(IS_DIRECTORY &quot;$&#123;path&#125;&quot;)  # 是目录if(TARGET target_name)      # 目标存在# 逻辑运算if(NOT condition)if(cond1 AND cond2)if(cond1 OR cond2)# 比较if(var EQUAL 5)if(var LESS 10)if(var GREATER 3)if(str STREQUAL &quot;value&quot;)if(ver VERSION_GREATER &quot;1.0&quot;)# 平台检测if(WIN32)if(UNIX)if(APPLE)if(MSVC)\n\n循环语句# foreach 循环foreach(item IN LISTS my_list)    message(&quot;Item: $&#123;item&#125;&quot;)endforeach()# 范围循环foreach(i RANGE 5)    message(&quot;i = $&#123;i&#125;&quot;)  # 0 到 5endforeach()foreach(i RANGE 1 10 2)    message(&quot;i = $&#123;i&#125;&quot;)  # 1, 3, 5, 7, 9endforeach()# while 循环set(i 0)while(i LESS 5)    message(&quot;i = $&#123;i&#125;&quot;)    math(EXPR i &quot;$&#123;i&#125; + 1&quot;)endwhile()# break 和 continueforeach(item IN LISTS my_list)    if(item STREQUAL &quot;skip&quot;)        continue()    endif()    if(item STREQUAL &quot;stop&quot;)        break()    endif()    message(&quot;$&#123;item&#125;&quot;)endforeach()\n\n函数和宏# 函数定义function(my_function arg1 arg2)    message(&quot;arg1: $&#123;arg1&#125;&quot;)    message(&quot;arg2: $&#123;arg2&#125;&quot;)    # 返回值通过 PARENT_SCOPE    set(result &quot;value&quot; PARENT_SCOPE)endfunction()# 调用函数my_function(&quot;hello&quot; &quot;world&quot;)# 宏定义（与函数的区别：宏在调用处展开，无独立作用域）macro(my_macro arg)    message(&quot;Macro arg: $&#123;arg&#125;&quot;)endmacro()# 可变参数# ARGN 是CMake的一个特殊变量，包含了传递给函数的所有参数（除了已命名的参数）function(print_all)    foreach(arg IN LISTS ARGN)        message(&quot;$&#123;arg&#125;&quot;)    endforeach()endfunction()print_all(&quot;a&quot; &quot;b&quot; &quot;c&quot;)# 命名参数function(create_target)    set(options OPTIONAL) # 开关参数    set(oneValueArgs NAME TYPE) # 单值参数，包括 NAME 和 TYPE    set(multiValueArgs SOURCES LIBS) #  多值参数，包括 SOURCES 和 LIBS    cmake_parse_arguments(ARG  # cmake_parse_arguments 解析传入的参数，将它们转换为前缀为 ARG_ 的变量        &quot;$&#123;options&#125;&quot;        &quot;$&#123;oneValueArgs&#125;&quot;        &quot;$&#123;multiValueArgs&#125;&quot;        $&#123;ARGN&#125;    )    message(&quot;Name: $&#123;ARG_NAME&#125;&quot;)    message(&quot;Sources: $&#123;ARG_SOURCES&#125;&quot;)endfunction()create_target(    NAME my_app    TYPE EXECUTABLE    SOURCES main.cpp util.cpp    LIBS pthread)\n\n\n参考资源\nCMake 官方文档\nModern CMake\nEffective Modern CMake\nCMake Cookbook\n\n","categories":["CMake"],"tags":["CMake","C++"]}]
[{"title":"CMake å…¥é—¨æ•™ç¨‹","url":"/2025/12/14/cmake-tutorial01/","content":"CMake ç®€ä»‹ä»€ä¹ˆæ˜¯ CMakeCMakeï¼ˆCross-platform Makeï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨ã€‚å®ƒä½¿ç”¨ç®€å•çš„é…ç½®æ–‡ä»¶ï¼ˆCMakeLists.txtï¼‰æ¥æ§åˆ¶è½¯ä»¶ç¼–è¯‘è¿‡ç¨‹ï¼Œå¹¶ç”Ÿæˆé€‚ç”¨äºä¸åŒå¹³å°çš„åŸç”Ÿæ„å»ºæ–‡ä»¶ï¼ˆå¦‚ Unix Makefileã€Visual Studio é¡¹ç›®æ–‡ä»¶ç­‰ï¼‰ã€‚\n\nä¸ºä»€ä¹ˆä½¿ç”¨ CMake\nè·¨å¹³å°æ”¯æŒï¼šä¸€å¥—é…ç½®æ–‡ä»¶å¯åœ¨ Windowsã€Linuxã€macOS ç­‰å¹³å°ä½¿ç”¨\nIDE é›†æˆï¼šæ”¯æŒç”Ÿæˆå¤šç§ IDE é¡¹ç›®æ–‡ä»¶\nç°ä»£åŒ–è®¾è®¡ï¼šæ”¯æŒç›®æ ‡ä¸ºä¸­å¿ƒçš„æ„å»ºç³»ç»Ÿ\nå¼ºå¤§çš„ä¾èµ–ç®¡ç†ï¼šå†…ç½®åŒ…æŸ¥æ‰¾å’Œä¾èµ–ç®¡ç†åŠŸèƒ½\nå¹¿æ³›é‡‡ç”¨ï¼šå¤§é‡å¼€æºé¡¹ç›®ä½¿ç”¨ CMakeï¼Œå·²ç»æˆä¸º C++ é¡¹ç›®æ„å»ºçš„äº‹å®æ ‡å‡†\n\nå®‰è£… CMakeWindows:CMakeå®˜ç½‘ä¸‹è½½å®‰è£…åŒ…\nLinux (Ubuntu&#x2F;Debian):\nsudo apt updatesudo apt install cmake\nå®‰è£…å®Œæˆåï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯\ncmake --version\n\nå¿«é€Ÿå¼€å§‹ç¬¬ä¸€ä¸ª CMake é¡¹ç›®åˆ›å»ºé¡¹ç›®ç»“æ„ï¼š\nmy_project/â”œâ”€â”€ CMakeLists.txtâ””â”€â”€ main.cpp\n\nmain.cpp:\n#include &lt;iostream&gt;int main() &#123;    std::cout &lt;&lt; &quot;Hello, CMake!&quot; &lt;&lt; std::endl;    return 0;&#125;\n\nCMakeLists.txt:\ncmake_minimum_required(VERSION 3.15)project(MyProject VERSION 1.0.0 LANGUAGES CXX)add_executable(myapp main.cpp)\n\næ„å»ºæµç¨‹# åˆ›å»ºæ„å»ºç›®å½•mkdir buildcd build# é…ç½®é¡¹ç›®cmake ..# Ubunt ä¸‹å°†åœ¨ build ç›®å½•ä¸‹ç”Ÿæˆ Makefile# Windows ä¸‹å°†åœ¨ build ç›®å½•ä¸‹ç”Ÿæˆ sln å’Œ vcxproj æ–‡ä»¶# Ubuntu ä¸‹ä½¿ç”¨ make ç¼–è¯‘make# Windows ä¸‹ä½¿ç”¨ MSBuild ç¼–è¯‘MSBuild myapp.sln /p:Configuration=Release# åœ¨æ„å»ºç›®å½•æ‰§è¡Œ./myapp# è¾“å‡º&gt; Hello, CMake!\n\n\nåŸºç¡€æ¦‚å¿µCMakeLists.txt åŸºæœ¬ç»“æ„# 1. æŒ‡å®šæœ€ä½ CMake ç‰ˆæœ¬cmake_minimum_required(VERSION 3.15)# 2. å®šä¹‰é¡¹ç›®project(ProjectName    VERSION 1.0.0    DESCRIPTION &quot;Project description&quot;    LANGUAGES CXX)# 3. è®¾ç½® C++ æ ‡å‡†set(CMAKE_CXX_STANDARD 17)set(CMAKE_CXX_STANDARD_REQUIRED ON)# 4. æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“add_executable(target_name source1.cpp source2.cpp)# 5. é“¾æ¥åº“ï¼ˆå¦‚æœéœ€è¦ï¼‰target_link_libraries(target_name PRIVATE some_library)\n\né¡¹ç›®ï¼ˆProjectï¼‰Project æ˜¯ CMake æ„å»ºç³»ç»Ÿçš„é¡¶å±‚å®¹å™¨ï¼Œä½¿ç”¨ project() å‘½ä»¤å®šä¹‰ï¼š\nProject å®Œæ•´è¯­æ³•å¦‚ä¸‹ï¼š\nproject(&lt;PROJECT-NAME&gt; [&lt;language-name&gt;...])project(&lt;PROJECT-NAME&gt;    [VERSION &lt;major&gt;[.&lt;minor&gt;[.&lt;patch&gt;[.&lt;tweak&gt;]]]]    [DESCRIPTION &lt;project-description-string&gt;]    [HOMEPAGE_URL &lt;url-string&gt;]    [LANGUAGES &lt;language-name&gt;...])\n\n\n&lt;PROJECT-NAME&gt; é¡¹ç›®çš„åç§°ï¼Œå¿…é¡»å”¯ä¸€\n[VERSION &lt;major&gt;[.&lt;minor&gt;[.&lt;patch&gt;[.&lt;tweak&gt;]]]] é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œæœ€å¤šåŒ…å«å››ä¸ªéƒ¨åˆ†\n[DESCRIPTION &lt;project-description-string&gt;] é¡¹ç›®çš„ç®€è¦æè¿°ä¿¡æ¯\n[HOMEPAGE_URL &lt;url-string&gt;] é¡¹ç›®ä¸»é¡µé“¾æ¥åœ°å€\n[LANGUAGES &lt;language-name&gt;...] æ˜¾å¼å£°æ˜é¡¹ç›®æ‰€ç”¨çš„ç¼–ç¨‹è¯­è¨€åˆ—è¡¨ï¼Œå¦‚ C, CXX\n\nç¤ºä¾‹ï¼š\nproject(MyProject    VERSION 1.2.3.4    DESCRIPTION &quot;My awesome project&quot;    HOMEPAGE_URL &quot;https://example.com&quot;    LANGUAGES CXX)\n\né¡¹ç›®å®šä¹‰åï¼ŒCMake ä¼šè‡ªåŠ¨è®¾ç½®ä»¥ä¸‹å˜é‡ï¼š\n\nPROJECT_NAME: é¡¹ç›®åç§°\nPROJECT_VERSION: é¡¹ç›®ç‰ˆæœ¬\nPROJECT_SOURCE_DIR: é¡¹ç›®æºç æ ¹ç›®å½•ï¼ŒåŒ…å«é¡¶çº§ CMakeLists.txt æ–‡ä»¶çš„ç›®å½•\nPROJECT_BINARY_DIR: é¡¹ç›®æ„å»ºæ ¹ç›®å½•ï¼Œè¿è¡Œ cmake å‘½ä»¤æ—¶æ‰€åœ¨çš„ç›®å½•\n\nç›®æ ‡ï¼ˆTargetï¼‰ç›®æ ‡æ˜¯ CMake çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä»£è¡¨æ„å»ºç³»ç»Ÿçš„è¾“å‡ºäº§ç‰©ï¼š\n\nå¯æ‰§è¡Œæ–‡ä»¶ç›®æ ‡: add_executable()\nåº“ç›®æ ‡: add_library()\nè‡ªå®šä¹‰ç›®æ ‡: add_custom_target()\n\nç°ä»£ CMake æ¨èä»¥ç›®æ ‡ä¸ºä¸­å¿ƒè¿›è¡Œé…ç½®ã€‚\nadd_executable å®Œæ•´è¯­æ³•å¦‚ä¸‹ï¼š\nadd_executable(&lt;name&gt; [WIN32] [MACOSX_BUNDLE] [EXCLUDE_FROM_ALL]               [source1] [source2 ...])\n\n&lt;name&gt; ç›®æ ‡çš„åç§°ï¼Œå¿…é¡»å”¯ä¸€\n[WIN32] ï¼ˆå¯é€‰ï¼‰åœ¨ Windows ä¸Šåˆ›å»º Win32 GUI åº”ç”¨ç¨‹åº\n[MACOSX_BUNDLE]ï¼ˆå¯é€‰ï¼‰åœ¨ macOS ä¸Šåˆ›å»ºåº”ç”¨ç¨‹åº bundle\n[EXCLUDE_FROM_ALL]ï¼ˆå¯é€‰ï¼‰ç›®æ ‡ä¸ä¼šè¢«é»˜è®¤æ„å»ºï¼Œéœ€è¦æ˜¾å¼æŒ‡å®šæ‰ä¼šæ„å»º\n[source1] [source2 ...]ï¼ˆå¯é€‰ï¼‰æºæ–‡ä»¶åˆ—è¡¨ï¼Œå¦‚æœä¸å¸¦æºæ–‡ä»¶åˆ—è¡¨ï¼Œéœ€è¦åç»­ä½¿ç”¨target_sourcesæ·»åŠ æºæ–‡ä»¶\n\nåœ¨  ç¬¬ä¸€ä¸ªCMakeé¡¹ç›® ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å¯æ‰§è¡Œæ–‡ä»¶ myappã€‚\nadd_executable(myapp main.cpp)\n\nç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰ç”Ÿæˆå™¨å†³å®š CMake ç”Ÿæˆä½•ç§æ„å»ºæ–‡ä»¶ï¼š\n# æŸ¥çœ‹å¯ç”¨ç”Ÿæˆå™¨cmake --help&gt; GeneratorsThe following generators are available on this platform (* marks default):  Green Hills MULTI            = Generates Green Hills MULTI files                                 (experimental, work-in-progress).* Unix Makefiles               = Generates standard UNIX makefiles.  Ninja                        = Generates build.ninja files.  Ninja Multi-Config           = Generates build-&lt;Config&gt;.ninja files.  Watcom WMake                 = Generates Watcom WMake makefiles.  CodeBlocks - Ninja           = Generates CodeBlocks project files.  CodeBlocks - Unix Makefiles  = Generates CodeBlocks project files.  CodeLite - Ninja             = Generates CodeLite project files.  CodeLite - Unix Makefiles    = Generates CodeLite project files.  Eclipse CDT4 - Ninja         = Generates Eclipse CDT 4.0 project files.  Eclipse CDT4 - Unix Makefiles= Generates Eclipse CDT 4.0 project files.  Kate - Ninja                 = Generates Kate project files.  Kate - Unix Makefiles        = Generates Kate project files.  Sublime Text 2 - Ninja       = Generates Sublime Text 2 project files.  Sublime Text 2 - Unix Makefiles                               = Generates Sublime Text 2 project files.\n\næ„å»ºç±»å‹ï¼ˆBuild Typeï¼‰CMake æ”¯æŒå¤šç§æ„å»ºç±»å‹ï¼š\n\nDebug: åŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œæ— ä¼˜åŒ–\nRelease: ä¼˜åŒ–ï¼Œæ— è°ƒè¯•ä¿¡æ¯\nRelWithDebInfo: ä¼˜åŒ– + è°ƒè¯•ä¿¡æ¯\nMinSizeRel: æœ€å°åŒ–å¤§å°ä¼˜åŒ–\n\n# è®¾ç½®é»˜è®¤æ„å»ºç±»å‹if(NOT CMAKE_BUILD_TYPE)    set(CMAKE_BUILD_TYPE Release)endif()\n\næ³¨æ„ï¼š é€šå¸¸ä¸éœ€è¦åœ¨CMakeä¸­è®¾ç½®ï¼Œè€Œæ˜¯åœ¨IDEä¸­é…ç½®\n\nCMake è¯­æ³•åŸºç¡€å‘½ä»¤è¯­æ³•CMake å‘½ä»¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ¨èä½¿ç”¨å°å†™ï¼š\n# åŸºæœ¬è¯­æ³•command(argument1 argument2 ...)# å¸¦å…³é”®å­—å‚æ•°command(TARGET target_name    PROPERTY value    OPTIONS opt1 opt2)# æ³¨é‡Š# è¿™æ˜¯å•è¡Œæ³¨é‡Š#[[è¿™æ˜¯å¤šè¡Œæ³¨é‡Šå¯ä»¥è·¨è¶Šå¤šè¡Œ]]\n\nå˜é‡æ™®é€šå˜é‡# è®¾ç½®å˜é‡set(MY_VAR &quot;value&quot;)set(MY_LIST &quot;item1&quot; &quot;item2&quot; &quot;item3&quot;)# ä½¿ç”¨å˜é‡message(&quot;Value: $&#123;MY_VAR&#125;&quot;)# å–æ¶ˆè®¾ç½®unset(MY_VAR)# å˜é‡ä½œç”¨åŸŸfunction(my_function)    set(LOCAL_VAR &quot;local&quot;)  # å‡½æ•°å†…å±€éƒ¨å˜é‡    set(PARENT_VAR &quot;parent&quot; PARENT_SCOPE)  # è®¾ç½®çˆ¶ä½œç”¨åŸŸå˜é‡endfunction()\n\nç¼“å­˜å˜é‡# ç¼“å­˜å˜é‡ï¼ˆä¿å­˜åœ¨ CMakeCache.txtï¼‰set(MY_CACHE_VAR &quot;value&quot; CACHE STRING &quot;Description&quot;)# ç±»å‹ï¼šBOOL, FILEPATH, PATH, STRING, INTERNALset(ENABLE_FEATURE ON CACHE BOOL &quot;Enable feature&quot;)# å¼ºåˆ¶è®¾ç½®ç¼“å­˜å˜é‡set(MY_VAR &quot;value&quot; CACHE STRING &quot;Description&quot; FORCE)\n\nç¯å¢ƒå˜é‡# è¯»å–ç¯å¢ƒå˜é‡message(&quot;PATH: $ENV&#123;PATH&#125;&quot;)# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»…åœ¨ CMake è¿›ç¨‹ä¸­ï¼‰set(ENV&#123;MY_VAR&#125; &quot;value&quot;)\n\nCMAKE å†…ç½®å˜é‡è·¯å¾„ç›¸å…³å˜é‡ï¼š\n# é¡¹ç›®æ ¹ç›®å½•ï¼ˆæœ€é¡¶å±‚ project() æ‰€åœ¨ç›®å½•ï¼‰$&#123;PROJECT_SOURCE_DIR&#125;# é¡¶å±‚æºç ç›®å½•ï¼ˆæœ€é¡¶å±‚ CMakeLists.txt æ‰€åœ¨ç›®å½•ï¼‰$&#123;CMAKE_SOURCE_DIR&#125;# å½“å‰ CMakeLists.txt æ‰€åœ¨ç›®å½•$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;# å½“å‰æ­£åœ¨å¤„ç†çš„ CMakeLists.txt æ–‡ä»¶æ‰€åœ¨ç›®å½•$&#123;CMAKE_CURRENT_LIST_DIR&#125;# å½“å‰æ­£åœ¨å¤„ç†çš„ CMakeLists.txt æ–‡ä»¶å®Œæ•´è·¯å¾„$&#123;CMAKE_CURRENT_LIST_FILE&#125;# é¡¹ç›®æ„å»ºæ ¹ç›®å½•$&#123;PROJECT_BINARY_DIR&#125;# é¡¶å±‚æ„å»ºç›®å½•$&#123;CMAKE_BINARY_DIR&#125;# å½“å‰æ„å»ºç›®å½•$&#123;CMAKE_CURRENT_BINARY_DIR&#125;# å®‰è£…ç›®å½•å‰ç¼€ï¼ˆé»˜è®¤ /usr/localï¼‰$&#123;CMAKE_INSTALL_PREFIX&#125;\n\né¡¹ç›®ä¿¡æ¯å˜é‡ï¼š\n# é¡¹ç›®åç§°$&#123;PROJECT_NAME&#125;# é¡¹ç›®ç‰ˆæœ¬å·$&#123;PROJECT_VERSION&#125;$&#123;PROJECT_VERSION_MAJOR&#125;  # ä¸»ç‰ˆæœ¬å·$&#123;PROJECT_VERSION_MINOR&#125;  # æ¬¡ç‰ˆæœ¬å·$&#123;PROJECT_VERSION_PATCH&#125;  # è¡¥ä¸ç‰ˆæœ¬å·$&#123;PROJECT_VERSION_TWEAK&#125;  # å¾®è°ƒç‰ˆæœ¬å·# é¡¹ç›®æè¿°$&#123;PROJECT_DESCRIPTION&#125;# é¡¹ç›®ä¸»é¡µ$&#123;PROJECT_HOMEPAGE_URL&#125;\n\nç¼–è¯‘å™¨å’Œç³»ç»Ÿå˜é‡ï¼š\n# C++ ç¼–è¯‘å™¨è·¯å¾„$&#123;CMAKE_CXX_COMPILER&#125;# C ç¼–è¯‘å™¨è·¯å¾„$&#123;CMAKE_C_COMPILER&#125;# ç¼–è¯‘å™¨ IDï¼ˆå¦‚ GNU, Clang, MSVCï¼‰$&#123;CMAKE_CXX_COMPILER_ID&#125;# æ“ä½œç³»ç»Ÿåç§°ï¼ˆå¦‚ Linux, Windows, Darwinï¼‰$&#123;CMAKE_SYSTEM_NAME&#125;# ç³»ç»Ÿç‰ˆæœ¬$&#123;CMAKE_SYSTEM_VERSION&#125;# å¤„ç†å™¨æ¶æ„ï¼ˆå¦‚ x86_64, arm64ï¼‰$&#123;CMAKE_SYSTEM_PROCESSOR&#125;\n\næ„å»ºé…ç½®å˜é‡ï¼š\n# æ„å»ºç±»å‹ï¼ˆDebug, Release, RelWithDebInfo, MinSizeRelï¼‰$&#123;CMAKE_BUILD_TYPE&#125;# C++ æ ‡å‡†ç‰ˆæœ¬ï¼ˆå¦‚ 11, 14, 17, 20ï¼‰$&#123;CMAKE_CXX_STANDARD&#125;# æ˜¯å¦è¦æ±‚ C++ æ ‡å‡†$&#123;CMAKE_CXX_STANDARD_REQUIRED&#125;# æ˜¯å¦å¯ç”¨ç¼–è¯‘å™¨æ‰©å±•$&#123;CMAKE_CXX_EXTENSIONS&#125;\n\nè¾“å‡ºç›®å½•å˜é‡ï¼š\n# å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºç›®å½•$&#123;CMAKE_RUNTIME_OUTPUT_DIRECTORY&#125;# åŠ¨æ€åº“è¾“å‡ºç›®å½•$&#123;CMAKE_LIBRARY_OUTPUT_DIRECTORY&#125;# é™æ€åº“è¾“å‡ºç›®å½•$&#123;CMAKE_ARCHIVE_OUTPUT_DIRECTORY&#125;\n\nå¹³å°æ£€æµ‹å˜é‡ï¼š\n# Windows å¹³å°ï¼ˆåŒ…æ‹¬ MinGWï¼‰$&#123;WIN32&#125;# Unix-like å¹³å°ï¼ˆLinux, macOS, BSDï¼‰$&#123;UNIX&#125;# macOS å¹³å°$&#123;APPLE&#125;# MSVC ç¼–è¯‘å™¨$&#123;MSVC&#125;# MinGW ç¼–è¯‘å™¨$&#123;MINGW&#125;# Cygwin ç¯å¢ƒ$&#123;CYGWIN&#125;\n\n\nåˆ—è¡¨ï¼ˆListsï¼‰# åˆ›å»ºåˆ—è¡¨set(MY_LIST &quot;a&quot; &quot;b&quot; &quot;c&quot;)set(MY_LIST &quot;a;b;c&quot;)  # ç­‰ä»·å†™æ³•# è¿½åŠ å…ƒç´ list(APPEND MY_LIST &quot;d&quot; &quot;e&quot;)# æ’å…¥å…ƒç´ list(INSERT MY_LIST 0 &quot;first&quot;)# ç§»é™¤å…ƒç´ list(REMOVE_ITEM MY_LIST &quot;b&quot;)# è·å–é•¿åº¦list(LENGTH MY_LIST list_length)# è·å–å…ƒç´ list(GET MY_LIST 0 first_item)# æŸ¥æ‰¾å…ƒç´ list(FIND MY_LIST &quot;c&quot; index)# æ’åºlist(SORT MY_LIST)# åè½¬list(REVERSE MY_LIST)\n\nå­—ç¬¦ä¸²æ“ä½œ# å­—ç¬¦ä¸²æ‹¼æ¥set(STR1 &quot;Hello&quot;)set(STR2 &quot;World&quot;)set(RESULT &quot;$&#123;STR1&#125; $&#123;STR2&#125;&quot;)# å­—ç¬¦ä¸²æ›¿æ¢string(REPLACE &quot;old&quot; &quot;new&quot; output_var &quot;$&#123;input_string&#125;&quot;)# æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…string(REGEX MATCH &quot;pattern&quot; output_var &quot;$&#123;input_string&#125;&quot;)# å¤§å°å†™è½¬æ¢string(TOUPPER &quot;$&#123;input&#125;&quot; output)string(TOLOWER &quot;$&#123;input&#125;&quot; output)# å­—ç¬¦ä¸²é•¿åº¦string(LENGTH &quot;$&#123;input&#125;&quot; length)# å­å­—ç¬¦ä¸²string(SUBSTRING &quot;$&#123;input&#125;&quot; 0 5 output)\n\næ¡ä»¶è¯­å¥# if-elseif(condition)    # ...elseif(other_condition)    # ...else()    # ...endif()# å¸¸ç”¨æ¡ä»¶if(DEFINED MY_VAR)          # å˜é‡å·²å®šä¹‰if(EXISTS &quot;$&#123;file_path&#125;&quot;)   # æ–‡ä»¶å­˜åœ¨if(IS_DIRECTORY &quot;$&#123;path&#125;&quot;)  # æ˜¯ç›®å½•if(TARGET target_name)      # ç›®æ ‡å­˜åœ¨# é€»è¾‘è¿ç®—if(NOT condition)if(cond1 AND cond2)if(cond1 OR cond2)# æ¯”è¾ƒif(var EQUAL 5)if(var LESS 10)if(var GREATER 3)if(str STREQUAL &quot;value&quot;)if(ver VERSION_GREATER &quot;1.0&quot;)# å¹³å°æ£€æµ‹if(WIN32)if(UNIX)if(APPLE)if(MSVC)\n\nå¾ªç¯è¯­å¥# foreach å¾ªç¯foreach(item IN LISTS my_list)    message(&quot;Item: $&#123;item&#125;&quot;)endforeach()# èŒƒå›´å¾ªç¯foreach(i RANGE 5)    message(&quot;i = $&#123;i&#125;&quot;)  # 0 åˆ° 5endforeach()foreach(i RANGE 1 10 2)    message(&quot;i = $&#123;i&#125;&quot;)  # 1, 3, 5, 7, 9endforeach()# while å¾ªç¯set(i 0)while(i LESS 5)    message(&quot;i = $&#123;i&#125;&quot;)    math(EXPR i &quot;$&#123;i&#125; + 1&quot;)endwhile()# break å’Œ continueforeach(item IN LISTS my_list)    if(item STREQUAL &quot;skip&quot;)        continue()    endif()    if(item STREQUAL &quot;stop&quot;)        break()    endif()    message(&quot;$&#123;item&#125;&quot;)endforeach()\n\nå‡½æ•°å’Œå®# å‡½æ•°å®šä¹‰function(my_function arg1 arg2)    message(&quot;arg1: $&#123;arg1&#125;&quot;)    message(&quot;arg2: $&#123;arg2&#125;&quot;)    # è¿”å›å€¼é€šè¿‡ PARENT_SCOPE    set(result &quot;value&quot; PARENT_SCOPE)endfunction()# è°ƒç”¨å‡½æ•°my_function(&quot;hello&quot; &quot;world&quot;)# å®å®šä¹‰ï¼ˆä¸å‡½æ•°çš„åŒºåˆ«ï¼šå®åœ¨è°ƒç”¨å¤„å±•å¼€ï¼Œæ— ç‹¬ç«‹ä½œç”¨åŸŸï¼‰macro(my_macro arg)    message(&quot;Macro arg: $&#123;arg&#125;&quot;)endmacro()# å¯å˜å‚æ•°# ARGN æ˜¯CMakeçš„ä¸€ä¸ªç‰¹æ®Šå˜é‡ï¼ŒåŒ…å«äº†ä¼ é€’ç»™å‡½æ•°çš„æ‰€æœ‰å‚æ•°ï¼ˆé™¤äº†å·²å‘½åçš„å‚æ•°ï¼‰function(print_all)    foreach(arg IN LISTS ARGN)        message(&quot;$&#123;arg&#125;&quot;)    endforeach()endfunction()print_all(&quot;a&quot; &quot;b&quot; &quot;c&quot;)# å‘½åå‚æ•°function(create_target)    set(options OPTIONAL) # å¼€å…³å‚æ•°    set(oneValueArgs NAME TYPE) # å•å€¼å‚æ•°ï¼ŒåŒ…æ‹¬ NAME å’Œ TYPE    set(multiValueArgs SOURCES LIBS) #  å¤šå€¼å‚æ•°ï¼ŒåŒ…æ‹¬ SOURCES å’Œ LIBS    cmake_parse_arguments(ARG  # cmake_parse_arguments è§£æä¼ å…¥çš„å‚æ•°ï¼Œå°†å®ƒä»¬è½¬æ¢ä¸ºå‰ç¼€ä¸º ARG_ çš„å˜é‡        &quot;$&#123;options&#125;&quot;        &quot;$&#123;oneValueArgs&#125;&quot;        &quot;$&#123;multiValueArgs&#125;&quot;        $&#123;ARGN&#125;    )    message(&quot;Name: $&#123;ARG_NAME&#125;&quot;)    message(&quot;Sources: $&#123;ARG_SOURCES&#125;&quot;)endfunction()create_target(    NAME myapp    TYPE EXECUTABLE    SOURCES main.cpp util.cpp    LIBS pthread)\n\nè°ƒè¯•æŠ€å·§# æ‰“å°å˜é‡å€¼message(STATUS &quot;Project source dir: $&#123;PROJECT_SOURCE_DIR&#125;&quot;)message(STATUS &quot;Build type: $&#123;CMAKE_BUILD_TYPE&#125;&quot;)# æ‰“å°æ‰€æœ‰å˜é‡ï¼ˆè°ƒè¯•ç”¨ï¼‰get_cmake_property(_variableNames VARIABLES)foreach(_variableName $&#123;_variableNames&#125;)    message(STATUS &quot;$&#123;_variableName&#125;=$&#123;$&#123;_variableName&#125;&#125;&quot;)endforeach()# æ‰“å°ç›®æ ‡å±æ€§get_target_property(MYAPP_SOURCES myapp SOURCES)message(STATUS &quot;myapp sources: $&#123;MYAPP_SOURCES&#125;&quot;)# å¯ç”¨è¯¦ç»†æ„å»ºè¾“å‡ºset(CMAKE_VERBOSE_MAKEFILE ON)# æˆ–åœ¨å‘½ä»¤è¡Œä½¿ç”¨ï¼š# cmake --build build --verbose\n\n\nè·¨å¹³å°è·¯å¾„å¤„ç†# CMake è‡ªåŠ¨å¤„ç†è·¯å¾„åˆ†éš”ç¬¦ï¼Œæ¨èå§‹ç»ˆä½¿ç”¨æ­£æ–œæ  /set(MY_PATH &quot;src/utils/logger.cpp&quot;)  # æ‰€æœ‰å¹³å°éƒ½æ”¯æŒset(FULL_PATH $&#123;PROJECT_SOURCE_DIR&#125;/src/main.cpp)  # æ¨èå†™æ³•# è½¬æ¢å¤–éƒ¨è·¯å¾„ï¼ˆå¦‚ç¯å¢ƒå˜é‡ï¼‰ä¸º CMake æ ¼å¼file(TO_CMAKE_PATH &quot;$ENV&#123;SOME_PATH&#125;&quot; CONVERTED_PATH)# è·¯å¾„æ‹¼æ¥ï¼ˆCMake 3.20+ï¼‰cmake_path(APPEND PROJECT_SOURCE_DIR &quot;src&quot; &quot;main.cpp&quot; OUTPUT_VARIABLE FULL_PATH)# è·¯å¾„è§£æget_filename_component(FILENAME $&#123;FULL_PATH&#125; NAME)        # æ–‡ä»¶åget_filename_component(DIR $&#123;FULL_PATH&#125; DIRECTORY)        # ç›®å½•get_filename_component(EXT $&#123;FULL_PATH&#125; EXT)              # æ‰©å±•åget_filename_component(NAME_WE $&#123;FULL_PATH&#125; NAME_WE)      # æ— æ‰©å±•åçš„æ–‡ä»¶å\n\né¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼ˆPCHï¼‰åŠ é€Ÿç¼–è¯‘# CMake 3.16+ æ”¯æŒtarget_precompile_headers(myapp PRIVATE    &lt;iostream&gt;    &lt;vector&gt;    &lt;string&gt;    &lt;memory&gt;)# æˆ–ä½¿ç”¨è‡ªå®šä¹‰å¤´æ–‡ä»¶target_precompile_headers(myapp PRIVATE    &quot;$&#123;PROJECT_SOURCE_DIR&#125;/include/pch.h&quot;)# å¤šä¸ªç›®æ ‡å…±äº« PCHï¼ˆæºç›®æ ‡éœ€ä½¿ç”¨ PUBLIC æˆ– INTERFACEï¼‰target_precompile_headers(mylib PUBLIC pch.h)target_precompile_headers(myapp REUSE_FROM mylib)\n\n\nå‚è€ƒèµ„æº\nCMake å®˜æ–¹æ–‡æ¡£\nModern CMake\nCMake Cookbook\n\n","categories":["CMake"],"tags":["CMake","C++"]},{"title":"CMake è¿›é˜¶æ•™ç¨‹ï¼ˆä¸€ï¼‰ï¼šå¤šæ–‡ä»¶é¡¹ç›®ç®¡ç†","url":"/2025/12/31/cmake-tutorial02/","content":"å‰è¨€åœ¨ ç¬¬ä¸€ä¸ª CMake é¡¹ç›® ä¸­ï¼Œæˆ‘ä»¬æ„å»ºçš„CMakeé¡¹ç›®ä»…åŒ…å«å•ä¸ªæºæ–‡ä»¶ã€‚ç„¶è€Œï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œé¡¹ç›®é€šå¸¸ç”±å¤šä¸ªæ–‡ä»¶å’Œç›®å½•ç»„æˆï¼Œå¹¶ä¸”å¸¸å¸¸éœ€è¦é›†æˆç¬¬ä¸‰æ–¹åº“æˆ–ç³»ç»Ÿåº“ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•æœ‰æ•ˆåœ°ç»„ç»‡å’Œç®¡ç†è¿™äº›æ–‡ä»¶ç»“æ„å‘¢ï¼Ÿ\n\nå¤šæ–‡ä»¶é¡¹ç›®project/â”œâ”€â”€ CMakeLists.txt          # ä¸» CMake é…ç½®â”œâ”€â”€ include/                # å…¬å…±å¤´æ–‡ä»¶â”‚   â””â”€â”€ operate.hâ”œâ”€â”€ src/                    # æºæ–‡ä»¶â”‚   â”œâ”€â”€ add.cppâ”‚   â”œâ”€â”€ div.cppâ”‚   â”œâ”€â”€ mult.cppâ”‚   â”œâ”€â”€ sub.cppâ”‚   â””â”€â”€ main.cppâ””â”€â”€ build/                  # æ„å»ºç›®å½•\n\nSRC:\n// operate.h#ifndef OPERATE_H#define OPERATE_Hint add(int a, int b);int divide(int a, int b);int multiply(int a, int b);int subtraction(int a, int b);#endif// add.cpp#include &lt;stdio.h&gt;#include &quot;operate.h&quot;int add(int a, int b) &#123; return a + b; &#125;// sub.cpp#include &lt;stdio.h&gt;#include &quot;operate.h&quot;int subtraction(int a, int b) &#123; return a - b; &#125;// mult.cpp#include &lt;stdio.h&gt;#include &quot;operate.h&quot;int multiply(int a, int b) &#123; return a * b; &#125;// div.cpp#include &lt;stdio.h&gt;#include &quot;operate.h&quot;int divide(int a, int b) &#123; return a / b; &#125;// main.cpp#include &lt;stdio.h&gt;#include &quot;operate.h&quot;auto main() -&gt; int&#123;    int a = 10;    int b = 2;    printf(&quot;add: %d\\n&quot;, add(a, b));    printf(&quot;subtraction: %d\\n&quot;, subtraction(a, b));    printf(&quot;multiply: %d\\n&quot;, multiply(a, b));    printf(&quot;divide: %d\\n&quot;, divide(a, b));    return 0;&#125;\n\nåŸºæœ¬ CMakeLists.txt é…ç½®CMakeLists.txtï¼š\ncmake_minimum_required(VERSION 3.15)project(Calculator VERSION 1.0.0 LANGUAGES CXX)set(EXECUTABLE_OUTPUT_PATH $&#123;CMAKE_BINARY_DIR&#125;/build)add_executable(Calculator    src/main.cpp    src/add.cpp    src/sub.cpp    src/mult.cpp    src/div.cpp    include/operate.h)target_include_directories(Calculator PRIVATE $&#123;PROJECT_SOURCE_DIR&#125;/include)\n\nä½¿ç”¨å˜é‡ç»„ç»‡æºæ–‡ä»¶å½“æ–‡ä»¶è¾ƒå¤šæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å˜é‡ç»„ç»‡æºæ–‡ä»¶ä½¿é€»è¾‘æ›´æ¸…æ™°ï¼Œä¾‹å¦‚ï¼š\nset(SOURCES    src/main.cpp    src/add.cpp    src/sub.cpp    src/mult.cpp    src/div.cpp    include/operate.h)add_executable(Calculator $&#123;SOURCES&#125;)\n\nset å®Œæ•´è¯­æ³•ï¼š\nset(&lt;variable&gt; &lt;value&gt;... [PARENT_SCOPE])\n\n\n&lt;variable&gt;ï¼šå˜é‡å\n&lt;value&gt;...ï¼šä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼Œå¤šä¸ªå€¼ä¼šç»„æˆåˆ—è¡¨\nPARENT_SCOPEï¼šå¯é€‰ï¼Œå°†å˜é‡è®¾ç½®åˆ°çˆ¶ä½œç”¨åŸŸ\n\nç¤ºä¾‹ï¼š\n# è®¾ç½®å•ä¸ªå€¼set(MY_VAR &quot;hello&quot;)# è®¾ç½®å¤šä¸ªå€¼ï¼ˆåˆ—è¡¨ï¼‰set(MY_LIST item1 item2 item3)# è®¾ç½®è·¯å¾„set(SRC_DIR $&#123;PROJECT_SOURCE_DIR&#125;/src)# è¿½åŠ åˆ°åˆ—è¡¨set(MY_LIST $&#123;MY_LIST&#125; item4)# æˆ–ä½¿ç”¨ list å‘½ä»¤list(APPEND MY_LIST item5)\n\nè‡ªåŠ¨æŸ¥æ‰¾æºæ–‡ä»¶aux_source_directoryæ‰‹åŠ¨ç®¡ç†æ¯ä¸ªæºæ–‡ä»¶ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä½¿ç”¨aux_source_directoryå‘½ä»¤å¯ä»¥è‡ªåŠ¨æŸ¥æ‰¾ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š\ninclude_directories($&#123;PROJECT_SOURCE_DIR&#125;/include)aux_source_directory(src SOURCES)add_executable(Calculator    $&#123;SOURCES&#125;)\n\naux_source_directory å®Œæ•´è¯­æ³•ï¼š\naux_source_directory(&lt;dir&gt; &lt;variable&gt;)\n\n\n&lt;dir&gt;ï¼šè¦æœç´¢çš„ç›®å½•è·¯å¾„\n&lt;variable&gt;ï¼šå­˜å‚¨æ‰¾åˆ°çš„æºæ–‡ä»¶åˆ—è¡¨çš„å˜é‡å\n\nç‰¹ç‚¹ï¼š\n\nè‡ªåŠ¨æŸ¥æ‰¾ .cã€.cppã€.ccã€.cxx ç­‰æºæ–‡ä»¶\nä¸ä¼šé€’å½’æœç´¢å­ç›®å½•ï¼Œåªæœç´¢æŒ‡å®šç›®å½•\nä¸åŒ…å«å¤´æ–‡ä»¶ï¼ˆ.hã€.hpp ç­‰ï¼‰\nå¦‚æœåœ¨CMakeLists.txtä¸­ä½¿ç”¨äº†è¯¥å‘½ä»¤ï¼ŒCMakeå°†ä¸èƒ½ç”Ÿæˆä¸€ä¸ªå¯ä»¥æ„ŸçŸ¥æ–°çš„æºæ–‡ä»¶ä½•æ—¶è¢«åŠ å…¥çš„æ„å»ºç³»ç»Ÿã€‚è¿™æ„å‘³ç€ï¼Œå½“æ–°æ–‡ä»¶è¢«æ·»åŠ åˆ°ç›®å½•ä¸­ä½†æ²¡æœ‰ä¿®æ”¹CMakeLists.txtæ–‡ä»¶æ—¶ï¼Œç”¨æˆ·å¿…é¡»æ‰‹åŠ¨é‡æ–°è¿è¡ŒCMakeæ¥ç”ŸæˆåŒ…å«æ–°æ–‡ä»¶çš„æ„å»ºç³»ç»Ÿ\n\n\næ³¨æ„ï¼šaux_source_directory å‘½ä»¤åªèƒ½æŸ¥æ‰¾æºæ–‡ä»¶ï¼Œä¸”ä¸ä¼šé€’å½’æŸ¥æ‰¾å­ç›®å½•ä¸‹çš„æºæ–‡ä»¶ï¼Œåªæœç´¢æŒ‡å®šçš„å•ä¸ªç›®å½•ã€‚å¦‚éœ€é€’å½’æœç´¢ï¼Œéœ€è¦ä½¿ç”¨ file(GLOB_RECURSE)ã€‚\n\nfile(GLOB) &amp; file(GLOB_RECURSE)file(GLOB_RECURSE APP_SRC_LIST main.cpp *.cpp *.h)add_executable(Calculator $&#123;APP_SRC_LIST&#125;)\n\nfile(GLOB)/file(GLOB_RECURSE) åŸºæœ¬è¯­æ³•ï¼š\nfile(GLOB &lt;variable&gt; [LIST_DIRECTORIES true|false]     [RELATIVE &lt;path&gt;] [CONFIGURE_DEPENDS]     [&lt;globbing-expressions&gt;...])file(GLOB_RECURSE &lt;variable&gt; [FOLLOW_SYMLINKS]     [LIST_DIRECTORIES true|false] [RELATIVE &lt;path&gt;]     [CONFIGURE_DEPENDS]     [&lt;globbing-expressions&gt;...])\n\n\n&lt;variable&gt;ï¼šå­˜å‚¨æ‰¾åˆ°çš„æ–‡ä»¶åˆ—è¡¨çš„å˜é‡å\nGLOBï¼šåœ¨æŒ‡å®šç›®å½•ä¸­æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶ ï¼ˆä¸é€’å½’ï¼‰\nGLOB_RECURSEï¼šé€’å½’æŸ¥æ‰¾æ•´ä¸ªç›®å½•æ ‘ä¸­åŒ¹é…çš„æ–‡ä»¶\nLIST_DIRECTORIESï¼šæ˜¯å¦åŒ…å«ç›®å½•ï¼ˆé»˜è®¤ trueï¼‰\nRELATIVE &lt;path&gt;ï¼šè¿”å›ç›¸å¯¹äºæŒ‡å®šè·¯å¾„çš„ç›¸å¯¹è·¯å¾„\nCONFIGURE_DEPENDSï¼šæ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œ CMakeï¼ˆæ¨èï¼‰\n&lt;globbing-expressions&gt;ï¼šé€šé…ç¬¦è¡¨è¾¾å¼ï¼ˆå¦‚ *.cppã€src/*.hï¼‰\n\né€šé…ç¬¦è§„åˆ™ï¼š\n\n*ï¼šåŒ¹é…ä»»æ„å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬ /ï¼‰\n?ï¼šåŒ¹é…å•ä¸ªå­—ç¬¦\n[abc]ï¼šåŒ¹é… aã€b æˆ– c\n**ï¼šåœ¨ GLOB_RECURSE ä¸­åŒ¹é…ä»»æ„å±‚çº§ç›®å½•\n\nç¤ºä¾‹ï¼š\n# æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰ .cpp æ–‡ä»¶ï¼ˆä¸é€’å½’ï¼‰file(GLOB SOURCES &quot;*.cpp&quot;)# é€’å½’æŸ¥æ‰¾æ‰€æœ‰ .cpp å’Œ .h æ–‡ä»¶file(GLOB_RECURSE ALL_SOURCES    &quot;src/*.cpp&quot;    &quot;src/*.h&quot;    &quot;include/*.h&quot;)# ä½¿ç”¨ CONFIGURE_DEPENDS è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å˜åŒ–file(GLOB_RECURSE SOURCES    CONFIGURE_DEPENDS    &quot;src/*.cpp&quot;)# è·å–ç›¸å¯¹è·¯å¾„file(GLOB_RECURSE SOURCES    RELATIVE $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;    &quot;src/*.cpp&quot;)# æ’é™¤ç‰¹å®šç›®å½•ï¼ˆéœ€è¦æ‰‹åŠ¨è¿‡æ»¤ï¼‰file(GLOB_RECURSE ALL_SOURCES &quot;src/*.cpp&quot;)list(FILTER ALL_SOURCES EXCLUDE REGEX &quot;.*test.*&quot;)\n\næ³¨æ„äº‹é¡¹ï¼š\n\næ·»åŠ &#x2F;åˆ é™¤æ–‡ä»¶åéœ€è¦æ‰‹åŠ¨é‡æ–°è¿è¡Œ CMake\nå¯èƒ½å¯¼è‡´æ„å»ºä¸ä¸€è‡´ï¼Œéœ€è¦æ¸…ç†æ„å»ºç¼“å­˜\nIDE å¯èƒ½æ— æ³•æ­£ç¡®è¯†åˆ«æ–°æ–‡ä»¶\n\nè§£å†³æ–¹æ¡ˆï¼š\n# ä½¿ç”¨ CONFIGURE_DEPENDSï¼ˆCMake 3.12+ï¼‰file(GLOB_RECURSE SOURCES CONFIGURE_DEPENDS &quot;src/*.cpp&quot;)\n\n\nå­é¡¹ç›®ç®¡ç†å¯¹äºæ›´å¤æ‚çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶æ‹†åˆ†æˆå‡ ä¸ªå­é¡¹ç›®ï¼Œæ¯ä¸ªå­é¡¹ç›®è´Ÿè´£ç‰¹å®šåŠŸèƒ½ï¼Œé€šè¿‡add_subdirectory ç»„ç»‡èµ·æ¥ã€‚\nadd_subdirectoryadd_subdirectory å‘½ä»¤ç”¨äºå°†å­ç›®å½•æ·»åŠ åˆ°æ„å»ºç³»ç»Ÿä¸­ï¼Œå­ç›®å½•å¿…é¡»åŒ…å«è‡ªå·±çš„ CMakeLists.txt æ–‡ä»¶ã€‚\nåŸºæœ¬è¯­æ³•ï¼š\nadd_subdirectory(source_dir [binary_dir] [EXCLUDE_FROM_ALL] [SYSTEM])\n\nå‚æ•°è¯´æ˜ï¼š\n\nsource_dirï¼šå­ç›®å½•çš„è·¯å¾„ï¼ˆç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼‰\nç›¸å¯¹è·¯å¾„ï¼šç›¸å¯¹äºå½“å‰æºç›®å½•ï¼ˆCMAKE_CURRENT_SOURCE_DIRï¼‰\nç»å¯¹è·¯å¾„ï¼šå¯ä»¥æŒ‡å‘æºç æ ‘å¤–çš„ç›®å½•\n\n\nbinary_dirï¼šå¯é€‰ï¼ŒæŒ‡å®šå­ç›®å½•çš„æ„å»ºè¾“å‡ºç›®å½•\nå¦‚æœçœç•¥ï¼Œé»˜è®¤ä½¿ç”¨ä¸ source_dir ç›¸åŒçš„ç›¸å¯¹è·¯å¾„\nå¯¹äºæºç æ ‘å¤–çš„ç›®å½•ï¼Œå¿…é¡»æŒ‡å®šæ­¤å‚æ•°\n\n\nEXCLUDE_FROM_ALLï¼šå¯é€‰ï¼Œæ’é™¤å­ç›®å½•çš„ç›®æ ‡\nå­ç›®å½•ä¸­çš„ç›®æ ‡ä¸ä¼šè¢«åŒ…å«åœ¨çˆ¶ç›®å½•çš„ ALL ç›®æ ‡ä¸­\nä¸ä¼šåœ¨é»˜è®¤æ„å»ºæ—¶è‡ªåŠ¨æ„å»ºï¼Œé™¤éè¢«æ˜¾å¼ä¾èµ–\né€‚ç”¨äºå¯é€‰ç»„ä»¶ã€ç¤ºä¾‹ä»£ç æˆ–æµ‹è¯•\n\n\nSYSTEMï¼šå¯é€‰ï¼ˆCMake 3.25+ï¼‰ï¼Œå°†å­ç›®å½•çš„åŒ…å«ç›®å½•æ ‡è®°ä¸ºç³»ç»Ÿç›®å½•\nå¯ä»¥æŠ‘åˆ¶æ¥è‡ªå­ç›®å½•å¤´æ–‡ä»¶çš„ç¼–è¯‘å™¨è­¦å‘Š\n\n\n\nç¤ºä¾‹é¡¹ç›®ï¼š\nproject/â”œâ”€â”€ CMakeLists.txt          # æ ¹ CMakeListsâ”œâ”€â”€ app/â”‚   â”œâ”€â”€ 3rd/â”‚   |   â””â”€â”€ nlohmanjson/â”‚   |       â””â”€â”€ json.hâ”‚   â”œâ”€â”€ CMakeLists.txt      # åº”ç”¨ çš„ CMakeListsâ”‚   â””â”€â”€ main.cppâ””â”€â”€ test/    â”œâ”€â”€ CMakeLists.txt      # æµ‹è¯•å·¥ç¨‹ çš„ CMakeLists    â””â”€â”€ main.cpp\n\næ ¹ CMakeLists.txtï¼š\ncmake_minimum_required(VERSION 3.15)project(MyProject VERSION 1.0.0 LANGUAGES CXX)# æ·»åŠ å­é¡¹ç›®add_subdirectory(app)add_subdirectory(test)\n\napp&#x2F;CMakeLists.txtï¼š\n# åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶add_executable(myapp main.cpp)# è®¾ç½®åŒ…å«ç›®å½•ï¼ˆåŒ…å«ç¬¬ä¸‰æ–¹åº“ï¼‰target_include_directories(myapp PRIVATE    $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/3rd/nlohmanjson)# è®¾ç½® C++ æ ‡å‡†target_compile_features(myapp PRIVATE cxx_std_17)\n\napp&#x2F;main.cppï¼š\n#include &quot;json.h&quot;  // ä½¿ç”¨ç¬¬ä¸‰æ–¹ JSON åº“int main() &#123;    // ä½¿ç”¨ nlohmann::json    return 0;&#125;\n\ntest&#x2F;CMakeLists.txtï¼š\n# åˆ›å»ºæµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶add_executable(mytest main.cpp)# è®¾ç½® C++ æ ‡å‡†target_compile_features(mytest PRIVATE cxx_std_17)\n\nä½¿ç”¨åœºæ™¯ï¼š\n# 1. åŸºæœ¬ç”¨æ³•ï¼šæ·»åŠ åŒçº§å­ç›®å½•add_subdirectory(src)add_subdirectory(test)# 2. æŒ‡å®šæ„å»ºç›®å½•add_subdirectory(test $&#123;CMAKE_BINARY_DIR&#125;/test/build)# 3. å¯é€‰ç»„ä»¶add_subdirectory(test EXCLUDE_FROM_ALL)# 4. æ¡ä»¶æ·»åŠ å­ç›®å½•option(BUILD_TEST &quot;Build test&quot; ON)if(BUILD_TEST)    add_subdirectory(test)endif()\n\nå˜é‡ä½œç”¨åŸŸä¸ä¼ é€’CMake å˜é‡æœ‰ä½œç”¨åŸŸé™åˆ¶ï¼Œç†è§£ä½œç”¨åŸŸå¯¹äºç®¡ç†å¤æ‚é¡¹ç›®è‡³å…³é‡è¦ã€‚\nä½œç”¨åŸŸç±»å‹1. å‡½æ•°ä½œç”¨åŸŸï¼ˆFunction Scopeï¼‰\nfunction(my_function)    set(LOCAL_VAR &quot;value&quot;)  # ä»…åœ¨å‡½æ•°å†…å¯è§    message(&quot;å‡½æ•°å†…ï¼š$&#123;LOCAL_VAR&#125;&quot;)endfunction()my_function()message(&quot;å‡½æ•°å¤–ï¼š$&#123;LOCAL_VAR&#125;&quot;)  # ç©ºå€¼ï¼Œå‡½æ•°å¤–ä¸å¯è§\n\n2. ç›®å½•ä½œç”¨åŸŸï¼ˆDirectory Scopeï¼‰\n# çˆ¶ç›®å½• CMakeLists.txtset(PARENT_VAR &quot;parent_value&quot;)add_subdirectory(subdir)  # æ·»åŠ å­ç›®å½•message(&quot;çˆ¶ç›®å½•ï¼š$&#123;PARENT_VAR&#125;&quot;)  # è¾“å‡º &quot;parent_value&quot;# subdir/CMakeLists.txtmessage(&quot;å­ç›®å½•ç»§æ‰¿ï¼š$&#123;PARENT_VAR&#125;&quot;)  # è¾“å‡º &quot;parent_value&quot;ï¼ˆç»§æ‰¿ï¼‰set(PARENT_VAR &quot;modified&quot;)           # ä¿®æ”¹ä»…åœ¨å­ç›®å½•æœ‰æ•ˆset(CHILD_VAR &quot;child_value&quot;)         # å­ç›®å½•å˜é‡# è¿”å›çˆ¶ç›®å½•åmessage(&quot;çˆ¶ç›®å½•ï¼š$&#123;PARENT_VAR&#125;&quot;)  # ä»ç„¶æ˜¯ &quot;parent_value&quot;ï¼ˆæœªè¢«ä¿®æ”¹ï¼‰message(&quot;çˆ¶ç›®å½•ï¼š$&#123;CHILD_VAR&#125;&quot;)   # ç©ºå€¼ï¼ˆå­ç›®å½•å˜é‡ä¸å¯è§ï¼‰\n\n3. ç¼“å­˜ä½œç”¨åŸŸï¼ˆCache Scopeï¼‰\n# ç¼“å­˜å˜é‡åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å¯è§set(CACHE_VAR &quot;value&quot; CACHE STRING &quot;Description&quot;)# åœ¨ä»»ä½• CMakeLists.txt ä¸­éƒ½å¯ä»¥è®¿é—®message(&quot;ç¼“å­˜å˜é‡ï¼š$&#123;CACHE_VAR&#125;&quot;)\n\nå˜é‡ä¼ é€’æ–¹æ³•æ–¹æ³• 1ï¼šPARENT_SCOPEï¼ˆå‘ç›´æ¥çˆ¶ä½œç”¨åŸŸä¼ é€’ï¼‰\n# å­ç›®å½• CMakeLists.txtset(RESULT &quot;computed_value&quot; PARENT_SCOPE)  # ä¼ é€’ç»™ ç›´æ¥çˆ¶ç›®å½•# æ³¨æ„ï¼šPARENT_SCOPE ä¸ä¼šåœ¨å½“å‰ä½œç”¨åŸŸè®¾ç½®å˜é‡set(VAR &quot;value&quot; PARENT_SCOPE)message(&quot;å½“å‰ä½œç”¨åŸŸï¼š$&#123;VAR&#125;&quot;)  # ç©ºå€¼ï¼# å¦‚æœéœ€è¦åœ¨å½“å‰å’Œçˆ¶ä½œç”¨åŸŸéƒ½è®¾ç½®ï¼Œéœ€è¦è°ƒç”¨ä¸¤æ¬¡set(VAR &quot;value&quot;)               # å½“å‰ä½œç”¨åŸŸset(VAR &quot;value&quot; PARENT_SCOPE)  # çˆ¶ä½œç”¨åŸŸ\n\næ–¹æ³• 2ï¼šCACHE å˜é‡ï¼ˆå…¨å±€å…±äº«ï¼‰\n# æ ¹ CMakeLists.txtset(GLOBAL_CONFIG &quot;value&quot; CACHE STRING &quot;å…¨å±€é…ç½®&quot;)# ä»»ä½•å­ç›®å½•éƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹# å­ç›®å½• CMakeLists.txtmessage(&quot;å…¨å±€é…ç½®ï¼š$&#123;GLOBAL_CONFIG&#125;&quot;)# å¼ºåˆ¶è¦†ç›–ç¼“å­˜å˜é‡set(GLOBAL_CONFIG &quot;new_value&quot; CACHE STRING &quot;å…¨å±€é…ç½®&quot; FORCE)\n\næ–¹æ³• 3ï¼šä½¿ç”¨å±æ€§ï¼ˆæ¨èç”¨äºç›®æ ‡é—´é€šä¿¡ï¼‰\n# è®¾ç½®å…¨å±€å±æ€§set_property(GLOBAL PROPERTY MY_GLOBAL_PROP &quot;value&quot;)# åœ¨ä»»ä½•åœ°æ–¹è¯»å–get_property(result GLOBAL PROPERTY MY_GLOBAL_PROP)message(&quot;å…¨å±€å±æ€§ï¼š$&#123;result&#125;&quot;)# è®¾ç½®mylibç›®æ ‡åº“å±æ€§ï¼šç‰ˆæœ¬1.0.0 , APIç‰ˆæœ¬ 1set_target_properties(mylib PROPERTIES    VERSION 1.0.0    SOVERSION 1)# è¯»å–ç›®æ ‡å±æ€§get_target_property(version mylib VERSION)\n\nå®ç”¨ç¤ºä¾‹æ¡ä»¶é…ç½®ä¼ é€’\n# æ ¹ CMakeLists.txtoption(ENABLE_TEST &quot;Enable test project&quot; ON)if(ENABLE_TEST)    set(TEST_ENABLED TRUE CACHE BOOL &quot;Test is enabled&quot;)    add_subdirectory(test)endif()# test/CMakeLists.txtif(TEST_ENABLED)    add_executable(mytest main.cpp)    target_compile_definitions(mytest PUBLIC TEST_ENABLED)endif()\n// test/main.cpp#ifdef TEST_ENABLED    std::cout &lt;&lt; &quot;Test mode enabled&quot; &lt;&lt; std::endl;#endif\n\nå¸¸è§é™·é˜±# âŒ é™·é˜± 1ï¼šPARENT_SCOPE ä¸å½±å“å½“å‰ä½œç”¨åŸŸfunction(set_value)    set(VAR &quot;value&quot; PARENT_SCOPE)    message(&quot;å‡½æ•°å†…ï¼š$&#123;VAR&#125;&quot;)  # ç©ºå€¼ï¼endfunction()# âœ… æ­£ç¡®ï¼šéœ€è¦è®¾ç½®ä¸¤æ¬¡function(set_value)    set(VAR &quot;value&quot; PARENT_SCOPE)  # çˆ¶ä½œç”¨åŸŸ    set(VAR &quot;value&quot;)               # å½“å‰ä½œç”¨åŸŸ    message(&quot;å‡½æ•°å†…ï¼š$&#123;VAR&#125;&quot;)      # è¾“å‡º &quot;value&quot;endfunction()# âŒ é™·é˜± 2ï¼šå­ç›®å½•ä¿®æ”¹ä¸å½±å“çˆ¶ç›®å½•# çˆ¶ CMakeLists.txtset(MY_LIST a b c)add_subdirectory(sub)message(&quot;$&#123;MY_LIST&#125;&quot;)  # ä»ç„¶æ˜¯ &quot;a;b;c&quot;# sub/CMakeLists.txtlist(APPEND MY_LIST d)  # åªåœ¨å­ç›®å½•æœ‰æ•ˆ# âœ… æ­£ç¡®ï¼šä½¿ç”¨ PARENT_SCOPE# sub/CMakeLists.txtlist(APPEND MY_LIST d)set(MY_LIST $&#123;MY_LIST&#125; PARENT_SCOPE)# âŒ é™·é˜± 3ï¼šç¼“å­˜å˜é‡çš„ä¼˜å…ˆçº§set(VAR &quot;normal&quot;)set(VAR &quot;cached&quot; CACHE STRING &quot;&quot;)message(&quot;$&#123;VAR&#125;&quot;)  # è¾“å‡º &quot;normal&quot;ï¼ˆæ™®é€šå˜é‡ä¼˜å…ˆï¼‰# âœ… ä½¿ç”¨ FORCE å¼ºåˆ¶è¦†ç›–set(VAR &quot;cached&quot; CACHE STRING &quot;&quot; FORCE)\n\n\n\nğŸ’¡ å®ç”¨æŠ€å·§å­é¡¹ç›®ç»„ç»‡åŸåˆ™# æŒ‰ä¾èµ–é¡ºåºæ·»åŠ add_subdirectory(app)    # åº”ç”¨ç¨‹åºadd_subdirectory(test)   # æµ‹è¯•ç¨‹åº# å¯é€‰ç»„ä»¶ä½¿ç”¨ EXCLUDE_FROM_ALLadd_subdirectory(examples EXCLUDE_FROM_ALL)add_subdirectory(benchmarks EXCLUDE_FROM_ALL)# æ¡ä»¶æ„å»ºoption(BUILD_TEST &quot;Build test&quot; ON)option(BUILD_DOCS &quot;Build documentation&quot; OFF)if(BUILD_TEST)    enable_testing()    add_subdirectory(test)endif()if(BUILD_DOCS)    add_subdirectory(docs)endif()\n\nè¾“å‡ºç›®å½•ç»Ÿä¸€ç®¡ç†# è®¾ç½®æ‰€æœ‰å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºåˆ° bin ç›®å½•set(CMAKE_RUNTIME_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/bin)# è®¾ç½®æ‰€æœ‰åº“æ–‡ä»¶è¾“å‡ºåˆ° lib ç›®å½•set(CMAKE_LIBRARY_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/lib)set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/lib)# é’ˆå¯¹ä¸åŒæ„å»ºç±»å‹è®¾ç½®ä¸åŒè¾“å‡ºç›®å½•set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG $&#123;CMAKE_BINARY_DIR&#125;/bin/debug)set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE $&#123;CMAKE_BINARY_DIR&#125;/bin/release)# æˆ–è€…é’ˆå¯¹å•ä¸ªç›®æ ‡è®¾ç½®set_target_properties(myapp PROPERTIES    RUNTIME_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/bin    LIBRARY_OUTPUT_DIRECTORY $&#123;CMAKE_BINARY_DIR&#125;/lib)\n\nå‚è€ƒèµ„æº\nCMake å®˜æ–¹æ–‡æ¡£ - add_subdirectory\nCMake å®˜æ–¹æ–‡æ¡£ - aux_source_directory\nCMake ä¿å§†çº§æ•™ç¨‹ï¼ˆä¸Šï¼‰ | çˆ±ç¼–ç¨‹çš„å¤§ä¸™\n\n","categories":["CMake"],"tags":["CMake","C++"]},{"title":"Seafile ç¤¾åŒºç‰ˆ13.0 éƒ¨ç½²","url":"/2026/01/30/seafile-deploy/","content":"æå‰å‡†å¤‡\nPC è‡³å°‘2æ ¸CPU å’Œ 2GB å†…å­˜ï¼Œæœ€å¥½é‡‡ç”¨é™æ€IP\nDocker ç¯å¢ƒ\nWindows WSL\n\nDockeræ¢æº\næ·»åŠ å†…å®¹ä¸ºï¼š\n&quot;registry-mirrors&quot;: [  &quot;https://2a6bf1988cb6428c877f723ec7530dbc.mirror.swr.myhuaweicloud.com&quot;,  &quot;https://docker.m.daocloud.io&quot;,  &quot;https://hub-mirror.c.163.com&quot;,  &quot;https://mirror.baidubce.com&quot;,  &quot;https://your_preferred_mirror&quot;,  &quot;https://dockerhub.icu&quot;,  &quot;https://docker.registry.cyou&quot;,  &quot;https://docker-cf.registry.cyou&quot;,  &quot;https://dockercf.jsdelivr.fyi&quot;,  &quot;https://docker.jsdelivr.fyi&quot;,  &quot;https://dockertest.jsdelivr.fyi&quot;,  &quot;https://mirror.aliyuncs.com&quot;,  &quot;https://dockerproxy.com&quot;,  &quot;https://mirror.baidubce.com&quot;,  &quot;https://docker.m.daocloud.io&quot;,  &quot;https://docker.nju.edu.cn&quot;,  &quot;https://docker.mirrors.sjtug.sjtu.edu.cn&quot;,  &quot;https://docker.mirrors.ustc.edu.cn&quot;,  &quot;https://mirror.iscas.ac.cn&quot;,  &quot;https://docker.rainbond.cc&quot;]\n\nå…¶ä»–æºå‚è€ƒï¼šDockeråŠ é€Ÿæºæ±‡æ€»\nSeafile Dockerä»ä»¥ä¸‹ç½‘å€ä¸­ä¸‹è½½.envã€seafile-server.ymlã€seadoc.ymlã€caddy.ymlå››ä¸ªæ–‡ä»¶https://manual.seafile.com/13.0/repo/docker/ce/envhttps://manual.seafile.com/13.0/repo/docker/ce/seafile-server.ymlhttps://manual.seafile.com/13.0/repo/docker/seadoc.ymlhttps://manual.seafile.com/13.0/repo/docker/caddy.yml\næ³¨æ„ï¼šwindowsä¸Šä»ç½‘é¡µç«¯ä¸‹è½½envæ–‡ä»¶åä¸­å¹¶æ²¡æœ‰.ï¼Œéœ€è¦æ‰‹åŠ¨æ”¹åä¸º.env\nä¸‹è½½å®Œä¹‹åï¼Œæˆ‘ä»¬æŠŠè¿™å››ä¸ªæ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæ¯”å¦‚seafile_dockeræ–‡ä»¶å¤¹ã€‚\næˆ‘ä»¬åªéœ€è¦éœ€æ”¹.envæ–‡ä»¶ä¸­çš„ä»¥ä¸‹å†…å®¹ï¼š\nBASIC_STORAGE_PATH=D:/seafile  # å­˜å‚¨è·¯å¾„SEAFILE_SERVER_HOSTNAME=192.168.2.165  # å¦‚æœæ²¡æœ‰åŸŸåï¼Œè¿™é‡Œç›´æ¥å¡«PCçš„IPTIME_ZONE=Asia/Shanghai # æ—¶åŒºJWT_PRIVATE_KEY=wc8pE3tKw3E3dwKw4qsQYMlEoG7PlOF8ofdcQQDb # å¯†é’¥\n\nå¯†é’¥å¯åœ¨WSLä¸­ï¼Œé€šè¿‡ä»¥ä¸‹æŒ‡ä»¤ç”Ÿæˆ\npwgen -s 40 1\n\nç”±äºæˆ‘ä»¬è®¾ç½®äº†BASIC_STORAGE_PATH&#x3D;D:&#x2F;seafileï¼Œæ‰€ä»¥seafileçš„æ•°æ®ä¼šå­˜å‚¨åœ¨D:&#x2F;seafileæ–‡ä»¶å¤¹ä¸­ã€‚\nSEAFILE_VOLUME=$BASIC_STORAGE_PATH/seafile-dataSEAFILE_MYSQL_VOLUME=$BASIC_STORAGE_PATH/seafile-mysql/dbSEAFILE_CADDY_VOLUME=$BASIC_STORAGE_PATH/seafile-caddySEADOC_VOLUME=$BASIC_STORAGE_PATH/seadoc-data\n\nåŸºäºä»¥ä¸Šè®¾ç½®ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä»¥ä¸‹æ–‡ä»¶ç»“æ„\nD:/seafile/â”œâ”€â”€ seafile-data/           # Seafile æ•°æ®å­˜å‚¨ç›®å½•â”œâ”€â”€ seafile-mysql/          # MySQL æ•°æ®å­˜å‚¨ç›®å½•â”‚   â””â”€â”€ db/                 # MySQL æ•°æ®åº“æ–‡ä»¶â”œâ”€â”€ seafile-caddy/          # Caddy æœåŠ¡å™¨é…ç½®å’Œæ•°æ®â””â”€â”€ seadoc-data/            # Seadoc æ–‡æ¡£æœåŠ¡æ•°æ®\n\nSeafile Docker éƒ¨ç½²æ¦‚è§ˆ å«æ¶æ„å›¾\nå‚æ•°è¯´æ˜å¯åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥çœ‹ï¼ˆè™½ç„¶æ¯”è¾ƒé›¶æ•£ï¼‰ï¼šSeafileéƒ¨ç½²ç¤¾åŒºç‰ˆ\nå¯åŠ¨Seafileé€šè¿‡ç®¡ç†å‘˜æƒé™æ‰“å¼€cmd,ç§»åŠ¨åˆ°seafile_dockeræ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ndocker compose -f seafile-server.yml -f seadoc.yml -f caddy.yml up -d\nç­‰å¾…æ‰§è¡Œå®Œæˆå³å¯ã€‚å¦‚æœ‰é”™è¯¯ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—ï¼š\ndocker compose -f seafile-server.yml -f seadoc.yml -f caddy.yml logs\nå¦‚éœ€è¦åœæ­¢ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ndocker compose -f seafile-server.yml -f seadoc.yml -f caddy.yml down\n\nå¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®http://192.168.2.165è®¿é—®Seafileã€‚\n\né…ç½®Seafileä½¿ç”¨rootç”¨æˆ·ç™»å½•ï¼Œè¿›å…¥ç³»ç»Ÿè®¾ç½®é¡µé¢ã€‚ä¸»è¦ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š\n\nè®¾ç½®ï¼šå“ç‰Œå®šåˆ¶ã€ç”¨æˆ·ç­–ç•¥é…ç½®ã€ç¾¤ç»„è®¾ç½®ã€å¯†ç ç­–ç•¥ã€èµ„æ–™åº“è®¾ç½®ã€åœ¨çº¿é¢„è§ˆé…ç½®ã€åŒæ­¥é…ç½®ã€‚\nç”¨æˆ·ï¼šå¯ç¼–è¾‘ç”¨æˆ·è´¦å·ä¿¡æ¯ã€‚\nç¾¤ç»„ï¼šå¯ç¼–è¾‘ç¾¤ç»„ä¿¡æ¯ã€‚\nèµ„æ–™åº“ï¼šå¯åˆ›å»ºæ–°çš„èµ„æ–™åº“ã€‚\n\n\neg.è®¾ç½®å…±äº«èµ„æ–™åº“\n\nå…³é—­æ³¨å†ŒåŠŸèƒ½\nä¸ºæ¯ä¸ªéœ€è¦çš„ç”¨æˆ·åˆ›å»ºè´¦æˆ·\nåˆ›å»ºç¾¤ç»„ï¼Œå¦‚â€œå¼€å‘éƒ¨â€\nå°†ç”¨æˆ·æ‹‰å…¥ç¾¤ç»„\nåˆ›å»ºèµ„æ–™åº“ï¼Œå¦‚â€œå¼€å‘éƒ¨å…±äº«â€\né…ç½®èµ„æ–™åº“æƒé™ï¼Œè®¾ç½®ä¸ºâ€œä»…å¯¹ç¾¤ç»„å¯è§â€ï¼Œå¹¶å°†â€œå¼€å‘éƒ¨â€æ·»åŠ åˆ°ç¾¤ç»„ä¸­\n\n\nç”¨æˆ·ä½¿ç”¨Seafileæä¾›äº†å¤šç§ä½¿ç”¨æ–¹å¼ï¼š\n\nç½‘é¡µä½¿ç”¨ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®http://192.168.2.165\nå“é¢åŒæ­¥å®¢æˆ·ç«¯\nç§»åŠ¨å®¢æˆ·ç«¯\næŒ‚è½½ç›˜å®¢æˆ·ç«¯\n\nSeafileå®¢æˆ·ç«¯ä¸‹è½½\nè¿™é‡Œæ¨èä½¿ç”¨SeafileæŒ‚è½½ç›˜å®¢æˆ·ç«¯\n\nå®‰è£…å®Œæˆåï¼Œåªéœ€è¦å¡«å†™ï¼š\n\näº‘ç›˜åœ°å€ï¼šhttp://192.168.2.165\nç”¨æˆ·åï¼šxxxxx\nå¯†ç ï¼šxxxxx\n\nç™»å½•å®Œæˆåï¼Œæ‰“å¼€æˆ‘çš„ç”µè„‘ï¼Œå³å¯çœ‹åˆ°æŒ‚è½½çš„äº‘ç›˜ã€‚\n","categories":["ç½‘ç›˜"],"tags":["Seafile","Docker","ç½‘ç›˜"]}]